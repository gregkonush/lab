apiVersion: argoproj.io/v1alpha1
kind: Sensor
metadata:
  name: github-codex
  namespace: argo-workflows
spec:
  eventBusName: default
  template:
    serviceAccountName: github-codex-sensor
  dependencies:
    - name: github-codex-event
      eventSourceName: github-codex
      eventName: github-codex-tasks
  triggers:
    - template:
        name: github-codex-workflow
        k8s:
          group: argoproj.io
          version: v1alpha1
          resource: workflows
          operation: create
          source:
            resource:
              apiVersion: argoproj.io/v1alpha1
              kind: Workflow
              metadata:
                generateName: github-codex-
                namespace: argo-workflows
              spec:
                workflowTemplateRef:
                  name: github-codex-task
                arguments:
                  parameters:
                    - name: stage
                      value: ""
                    - name: prompt
                      value: ""
                    - name: repository
                      value: ""
                    - name: base
                      value: ""
                    - name: head
                      value: ""
                    - name: issueNumber
                      value: ""
                    - name: issueUrl
                      value: ""
                    - name: issueTitle
                      value: ""
                    - name: issueBody
                      value: ""
                    - name: planCommentId
                      value: ""
                    - name: planCommentUrl
                      value: ""
                    - name: planCommentBody
                      value: ""
      parameters:
        - src:
            dependencyName: github-codex-event
            dataKey: body.stage
          dest: spec.arguments.parameters.0.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.prompt
          dest: spec.arguments.parameters.1.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.repository
          dest: spec.arguments.parameters.2.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.base
          dest: spec.arguments.parameters.3.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.head
          dest: spec.arguments.parameters.4.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.issueNumber
          dest: spec.arguments.parameters.5.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.issueUrl
          dest: spec.arguments.parameters.6.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.issueTitle
          dest: spec.arguments.parameters.7.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.issueBody
          dest: spec.arguments.parameters.8.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.planCommentId
          dest: spec.arguments.parameters.9.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.planCommentUrl
          dest: spec.arguments.parameters.10.value
        - src:
            dependencyName: github-codex-event
            dataKey: body.planCommentBody
          dest: spec.arguments.parameters.11.value

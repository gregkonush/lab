apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: gitea
helmCharts:
  - name: gitea
    repo: https://dl.gitea.com/charts
    version: v10.4.0
    releaseName: gitea
    namespace: gitea
    valuesMerge: merge
    valuesInline:
      ingress:
        enabled: true
        className: traefik
        annotations:
          kubernetes.io/ingress.class: traefik
          cert-manager.io/issue-temporary-certificate: "true"
          acme.cert-manager.io/http01-edit-in-place: "true"
          cert-manager.io/cluster-issuer: "letsencrypt-prod"
          traefik.ingress.kubernetes.io/router.entrypoints: web,websecure
          traefik.ingress.kubernetes.io/router.tls: "true"
        hosts:
          - host: gitea.grisha.cloud
            paths:
              - path: /
                pathType: Prefix
          - host: gitea.lan
            paths:
              - path: /
                pathType: Prefix
          - host: gitea.proompteng.ai
            paths:
              - path: /
                pathType: Prefix
        tls:
          - secretName: gitea-tls
            hosts:
              - gitea.grisha.cloud
      gitea:
        config:
          server:
            PROTOCOL: https
            DOMAIN: gitea.grisha.cloud
            ROOT_URL: https://gitea.grisha.cloud
            SSH_DOMAIN: gitea.grisha.cloud
            ENABLE_ACME: true
            ACME_ACCEPTTOS: true
            ACME_DIRECTORY: https://acme-v02.api.letsencrypt.org/directory
            ACME_EMAIL: gkonushev@outlook.com

# $schema: https://raw.githubusercontent.com/knative/func/2988acf3/schema/func_yaml-schema.json
# yaml-language-server: $schema=https://raw.githubusercontent.com/knative/func/2988acf3/schema/func_yaml-schema.json
specVersion: 1.17.0
name: froussard
runtime: typescript
registry: registry.ide-newton.ts.net/lab
namespace: froussard
created: 2025-03-30T10:30:06.936905-07:00
build:
  builderImages:
    platforms: linux/arm64
    s2i: registry.ide-newton.ts.net/lab/baozi
  builder: s2i
run:
  envs:
  - name: GITHUB_WEBHOOK_SECRET
    value: '{{ secret:github-secret:webhook-secret }}'
  - name: KAFKA_BROKERS
    value: kafka-kafka-bootstrap.kafka:9092
  - name: KAFKA_TOPIC
    value: github.webhook.events
  - name: KAFKA_CODEX_TOPIC
    value: github.codex.tasks
  - name: KAFKA_CODEX_TOPIC_STRUCTURED
    value: github.issues.codex.tasks
  - name: KAFKA_DISCORD_COMMAND_TOPIC
    value: discord.commands.incoming
  - name: KAFKA_USERNAME
    value: froussard
  - name: KAFKA_PASSWORD
    value: '{{ secret:froussard:password }}'
  - name: KAFKAJS_NO_PARTITIONER_WARNING
    value: "1"
  - name: GITHUB_TOKEN
    value: '{{ secret:github-token:token }}'
  - name: DISCORD_PUBLIC_KEY
    value: '{{ secret:discord-bot:public-key }}'
  - name: OTEL_SERVICE_NAME
    value: froussard
  - name: OTEL_SERVICE_NAMESPACE
    value: froussard
  - name: FROUSSARD_VERSION
    value: '{{ env:FROUSSARD_VERSION }}'
  - name: FROUSSARD_COMMIT
    value: '{{ env:FROUSSARD_COMMIT }}'
  - name: LGTM_TEMPO_TRACES_ENDPOINT
    value: http://observability-tempo-gateway.observability.svc.cluster.local:4318/v1/traces
  - name: LGTM_MIMIR_METRICS_ENDPOINT
    value: http://observability-mimir-nginx.observability.svc.cluster.local/otlp/v1/metrics
  - name: LGTM_LOKI_ENDPOINT
    value: http://observability-loki-loki-distributed-gateway.observability.svc.cluster.local/loki/api/v1/push
  - name: OTEL_EXPORTER_OTLP_PROTOCOL
    value: http/protobuf
deploy:
  namespace: froussard
  image: registry.ide-newton.ts.net/lab/froussard@sha256:fc1b4a91fef8accb889ab693aaa0f547a1f1a12314c8f85bfa7eb48025860ead
  annotations:
    serving.knative.dev/revision-history-limit: "3"
  options:
    scale:
      min: 1
